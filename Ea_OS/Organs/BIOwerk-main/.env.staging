# ==============================================================================
# BIOwerk Staging Environment Configuration
# ==============================================================================
#
# ⚠️  SECURITY NOTICE: Replace ALL placeholder values before deploying ⚠️
#
# This file contains staging-specific configuration. Secrets should be managed
# via your CI/CD platform's secret management (GitHub Secrets, AWS Secrets Manager, etc.)
#
# ==============================================================================

# ============================================================================
# Environment
# ============================================================================
ENVIRONMENT=staging
LOG_LEVEL=DEBUG
LOG_FORMAT=json

# ============================================================================
# PostgreSQL Configuration (Staging Database)
# ============================================================================
POSTGRES_HOST=staging-postgres.internal
POSTGRES_PORT=5432
POSTGRES_USER=biowerk_staging
POSTGRES_PASSWORD=${STAGING_POSTGRES_PASSWORD}  # From secrets manager
POSTGRES_DB=biowerk_staging

# ============================================================================
# PgBouncer Connection Pooling
# ============================================================================
PGBOUNCER_POOL_MODE=transaction
PGBOUNCER_MAX_CLIENT_CONN=150
PGBOUNCER_DEFAULT_POOL_SIZE=20
PGBOUNCER_MIN_POOL_SIZE=5
PGBOUNCER_RESERVE_POOL_SIZE=5
PGBOUNCER_MAX_DB_CONNECTIONS=30
PGBOUNCER_SERVER_IDLE_TIMEOUT=600
PGBOUNCER_LOG_CONNECTIONS=1
PGBOUNCER_LOG_DISCONNECTIONS=1

# ============================================================================
# MongoDB Configuration (Staging)
# ============================================================================
MONGO_HOST=staging-mongodb.internal
MONGO_PORT=27017
MONGO_INITDB_ROOT_USERNAME=biowerk_staging
MONGO_INITDB_ROOT_PASSWORD=${STAGING_MONGO_PASSWORD}  # From secrets manager
MONGO_INITDB_DATABASE=biowerk_staging

# ============================================================================
# Redis Configuration (Staging)
# ============================================================================
REDIS_HOST=staging-redis.internal
REDIS_PORT=6379
REDIS_PASSWORD=${STAGING_REDIS_PASSWORD}  # From secrets manager
REDIS_DB=0

# ============================================================================
# Cache Configuration
# ============================================================================
CACHE_TTL=300
CACHE_ENABLED=true

# ============================================================================
# Authentication Configuration
# ============================================================================
JWT_SECRET_KEY=${STAGING_JWT_SECRET}  # From secrets manager
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
API_KEY_HEADER=X-API-Key
REQUIRE_AUTH=true  # Always enabled in staging

# ============================================================================
# TLS/HTTPS Configuration
# ============================================================================
TLS_ENABLED=true
TLS_CERT_FILE=/etc/ssl/certs/staging.biowerk.crt
TLS_KEY_FILE=/etc/ssl/private/staging.biowerk.key
TLS_CA_FILE=/etc/ssl/certs/ca-bundle.crt
TLS_VERIFY_CLIENT=false
TLS_MIN_VERSION=TLSv1.2
TLS_CIPHERS=

# ============================================================================
# Rate Limiting Configuration
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=200  # More permissive for testing
RATE_LIMIT_WINDOW=60
RATE_LIMIT_STRATEGY=sliding_window
RATE_LIMIT_PER_IP=true
RATE_LIMIT_PER_USER=true
RATE_LIMIT_BURST=40

# ============================================================================
# Agent URLs (Staging Service Mesh)
# ============================================================================
AGENT_OSTEON_URL=http://staging-osteon.internal:8001
AGENT_MYOCYTE_URL=http://staging-myocyte.internal:8002
AGENT_SYNAPSE_URL=http://staging-synapse.internal:8003
AGENT_CIRCADIAN_URL=http://staging-circadian.internal:8004
AGENT_NUCLEUS_URL=http://staging-nucleus.internal:8005
AGENT_CHAPERONE_URL=http://staging-chaperone.internal:8006
AGENT_GDPR_URL=http://staging-gdpr.internal:8010

# ============================================================================
# Audit Logging Configuration
# ============================================================================
AUDIT_ENABLED=true
AUDIT_LOG_REQUESTS=true
AUDIT_LOG_RESPONSES=true
AUDIT_ENCRYPT_SENSITIVE=true
AUDIT_RETENTION_DAYS=90  # Shorter retention for staging
AUDIT_RETENTION_AUTH_DAYS=30
AUDIT_RETENTION_DATA_DAYS=90
AUDIT_RETENTION_SECURITY_DAYS=180
AUDIT_COLLECT_GEO=true
AUDIT_MAX_FIELD_SIZE=65536
AUDIT_BATCH_SIZE=100
AUDIT_ASYNC_WRITE=true

# ============================================================================
# Encryption Configuration
# ============================================================================
ENCRYPTION_ENABLED=true
ENCRYPTION_MASTER_KEY=${STAGING_ENCRYPTION_KEY}  # From secrets manager
ENCRYPTION_KEY_VERSION=1
ENCRYPTION_KEY_ROTATION_DAYS=90
ENCRYPTION_SALT=${STAGING_ENCRYPTION_SALT}  # From secrets manager
ENCRYPTION_ALGORITHM=AES-256-GCM

# ============================================================================
# Data Retention Policy
# ============================================================================
RETENTION_ENABLED=true
RETENTION_EVALUATION_INTERVAL_HOURS=24
RETENTION_ARCHIVE_CLEANUP_INTERVAL_HOURS=168
RETENTION_DEFAULT_AUDIT_LOG_DAYS=90
RETENTION_DEFAULT_USER_DATA_DAYS=90
RETENTION_DEFAULT_EXECUTION_DAYS=30
RETENTION_DEFAULT_PROJECT_DAYS=90
RETENTION_DEFAULT_ARTIFACT_DAYS=90
RETENTION_DEFAULT_API_KEY_DAYS=30
RETENTION_DEFAULT_SESSION_DAYS=14
RETENTION_DEFAULT_CACHE_DAYS=3
RETENTION_ARCHIVE_EXPIRATION_DAYS=180
RETENTION_REQUIRE_ARCHIVE_BEFORE_DELETE=true
RETENTION_LEGAL_HOLD_ENABLED=true
RETENTION_COMPLIANCE_ALERTS_ENABLED=true
RETENTION_DRY_RUN=false

# ============================================================================
# LLM Provider Configuration (Staging)
# ============================================================================
LLM_PROVIDER=ollama
OLLAMA_BASE_URL=http://staging-ollama.internal:11434
OLLAMA_MODEL=phi3:mini
OLLAMA_MAX_TOKENS=4096
OLLAMA_TEMPERATURE=0.7
OLLAMA_TIMEOUT=120

# Cloud LLM providers (for testing)
OPENAI_API_KEY=${STAGING_OPENAI_API_KEY}
OPENAI_MODEL=gpt-4o-mini  # Cost-effective for staging
ANTHROPIC_API_KEY=${STAGING_ANTHROPIC_API_KEY}
DEEPSEEK_API_KEY=${STAGING_DEEPSEEK_API_KEY}

# ============================================================================
# OpenTelemetry / Distributed Tracing
# ============================================================================
OTEL_ENABLED=true
OTEL_SERVICE_NAME=biowerk-staging
OTEL_EXPORTER_TYPE=otlp
OTEL_EXPORTER_ENDPOINT=http://staging-jaeger.internal:4317
OTEL_EXPORTER_PROTOCOL=grpc
OTEL_SAMPLING_RATIO=1.0  # 100% sampling in staging
OTEL_LOG_CORRELATION=true
OTEL_EXPORT_TIMEOUT=30
OTEL_MAX_QUEUE_SIZE=2048
OTEL_MAX_EXPORT_BATCH_SIZE=512
OTEL_INSTRUMENT_DB=true
OTEL_INSTRUMENT_HTTP=true
OTEL_INSTRUMENT_REDIS=true

# ============================================================================
# Health Check Configuration
# ============================================================================
HEALTH_ENABLED=true
HEALTH_CHECK_DB=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_DEPENDENCIES=true
HEALTH_CHECK_TIMEOUT=5.0
HEALTH_STARTUP_GRACE_PERIOD=30

# ============================================================================
# Monitoring & Alerting (Staging)
# ============================================================================
REGION=us-east-1

# Prometheus/Grafana endpoints
PROMETHEUS_URL=http://staging-prometheus.internal:9090
GRAFANA_URL=http://staging-grafana.internal:3000

# ============================================================================
# Slack Integration (Staging Channels)
# ============================================================================
SLACK_CRITICAL_WEBHOOK_URL=${SLACK_STAGING_CRITICAL_WEBHOOK}
SLACK_CRITICAL_CHANNEL=#biowerk-staging-critical
SLACK_WARNINGS_WEBHOOK_URL=${SLACK_STAGING_WARNINGS_WEBHOOK}
SLACK_WARNINGS_CHANNEL=#biowerk-staging-warnings
SLACK_INFO_WEBHOOK_URL=${SLACK_STAGING_INFO_WEBHOOK}
SLACK_INFO_CHANNEL=#biowerk-staging-info
SLACK_DATABASE_WEBHOOK_URL=${SLACK_STAGING_DATABASE_WEBHOOK}
SLACK_DATABASE_CHANNEL=#biowerk-staging-database
SLACK_SECURITY_WEBHOOK_URL=${SLACK_STAGING_SECURITY_WEBHOOK}
SLACK_SECURITY_CHANNEL=#biowerk-staging-security

# ============================================================================
# Email Alerting (Staging)
# ============================================================================
SMTP_HOST=smtp.gmail.com:587
SMTP_USERNAME=${STAGING_SMTP_USERNAME}
SMTP_PASSWORD=${STAGING_SMTP_PASSWORD}
DEFAULT_EMAIL_TO=staging-ops@example.com
DATABASE_TEAM_EMAIL=staging-db@example.com
COMPLIANCE_TEAM_EMAIL=staging-compliance@example.com

# ============================================================================
# PagerDuty (Staging - Optional)
# ============================================================================
PAGERDUTY_SERVICE_KEY=${STAGING_PAGERDUTY_KEY}
PAGERDUTY_SECURITY_SERVICE_KEY=${STAGING_PAGERDUTY_SECURITY_KEY}

# ============================================================================
# Grafana Configuration (Staging)
# ============================================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=${STAGING_GRAFANA_PASSWORD}
GRAFANA_SECRET_KEY=${STAGING_GRAFANA_SECRET}
GRAFANA_DB_TYPE=postgres
GRAFANA_DB_HOST=staging-postgres.internal:5432
GRAFANA_DB_NAME=grafana_staging
GRAFANA_DB_USER=grafana_staging
GRAFANA_DB_PASSWORD=${STAGING_GRAFANA_DB_PASSWORD}
GRAFANA_LOG_LEVEL=debug

# ============================================================================
# Backup & Disaster Recovery (Staging)
# ============================================================================
BACKUP_LOG_LEVEL=DEBUG
POSTGRES_BACKUP_ENABLED=true
POSTGRES_BACKUP_SCHEDULE=0 3 * * *  # Daily at 3 AM
MONGODB_BACKUP_ENABLED=true
MONGODB_BACKUP_SCHEDULE=30 3 * * *
REDIS_BACKUP_ENABLED=true
REDIS_BACKUP_SCHEDULE=0 4 * * *

# Retention (shorter for staging)
BACKUP_RETENTION_DAYS=7
BACKUP_RETENTION_WEEKLY=4
BACKUP_RETENTION_MONTHLY=3

# Backup options
BACKUP_COMPRESSION=zstd
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_VERIFY=true
BACKUP_VERIFICATION_SCHEDULE=0 5 * * 0

# S3 Configuration for staging backups
BACKUP_S3_ENABLED=true
BACKUP_S3_BUCKET=biowerk-staging-backups
BACKUP_S3_REGION=us-east-1
BACKUP_S3_STORAGE_CLASS=STANDARD_IA
AWS_ACCESS_KEY_ID=${STAGING_AWS_ACCESS_KEY}
AWS_SECRET_ACCESS_KEY=${STAGING_AWS_SECRET_KEY}

# DR Configuration
DR_RTO_TARGET=8h  # More relaxed for staging
DR_RPO_TARGET=4h
DR_TEST_ENABLED=true
DR_TEST_SCHEDULE=0 5 * * 0

# ============================================================================
# GDPR Configuration (Staging)
# ============================================================================
ENCRYPTION_MASTER_KEY=${STAGING_GDPR_ENCRYPTION_KEY}
ENCRYPTION_KEY_ROTATION_DAYS=90
GDPR_EXPORT_BASE_PATH=/var/gdpr_exports
GDPR_SLA_DAYS=30
GDPR_EXPORT_EXPIRY_DAYS=30
GDPR_AUTO_RETENTION_ENABLED=true

# ============================================================================
# Feature Flags (Staging - for testing new features)
# ============================================================================
ENABLE_EXPERIMENTAL_FEATURES=true
ENABLE_DEBUG_ENDPOINTS=true
ENABLE_VERBOSE_LOGGING=true
