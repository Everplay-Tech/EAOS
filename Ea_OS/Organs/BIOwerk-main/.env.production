# ==============================================================================
# BIOwerk Production Environment Configuration
# ==============================================================================
#
# ⚠️  CRITICAL SECURITY NOTICE ⚠️
#
# This file contains production configuration. ALL secrets MUST be managed
# via secure secrets management systems:
# - AWS Secrets Manager
# - Azure Key Vault
# - HashiCorp Vault
# - Google Cloud Secret Manager
# - Kubernetes Secrets
#
# NEVER commit actual production secrets to version control!
#
# ==============================================================================

# ============================================================================
# Environment
# ============================================================================
ENVIRONMENT=production
LOG_LEVEL=WARNING  # Reduce noise in production
LOG_FORMAT=json  # Required for log aggregation

# ============================================================================
# PostgreSQL Configuration (Production Database)
# ============================================================================
POSTGRES_HOST=prod-postgres-primary.internal
POSTGRES_PORT=5432
POSTGRES_USER=biowerk_prod
POSTGRES_PASSWORD=${PROD_POSTGRES_PASSWORD}  # From secrets manager
POSTGRES_DB=biowerk_production

# Read replicas for scaling
POSTGRES_READ_REPLICA_1=prod-postgres-replica-1.internal
POSTGRES_READ_REPLICA_2=prod-postgres-replica-2.internal

# ============================================================================
# PgBouncer Connection Pooling (Production)
# ============================================================================
PGBOUNCER_POOL_MODE=transaction
PGBOUNCER_MAX_CLIENT_CONN=500  # Scale for production load
PGBOUNCER_DEFAULT_POOL_SIZE=50
PGBOUNCER_MIN_POOL_SIZE=20
PGBOUNCER_RESERVE_POOL_SIZE=20
PGBOUNCER_MAX_DB_CONNECTIONS=100
PGBOUNCER_SERVER_IDLE_TIMEOUT=600
PGBOUNCER_LOG_CONNECTIONS=0  # Disable to reduce log volume
PGBOUNCER_LOG_DISCONNECTIONS=0

# ============================================================================
# MongoDB Configuration (Production)
# ============================================================================
MONGO_HOST=prod-mongodb-primary.internal
MONGO_PORT=27017
MONGO_INITDB_ROOT_USERNAME=biowerk_prod
MONGO_INITDB_ROOT_PASSWORD=${PROD_MONGO_PASSWORD}  # From secrets manager
MONGO_INITDB_DATABASE=biowerk_production

# MongoDB replica set
MONGO_REPLICA_SET=biowerk-prod-rs
MONGO_READ_PREFERENCE=secondaryPreferred

# ============================================================================
# Redis Configuration (Production)
# ============================================================================
REDIS_HOST=prod-redis-primary.internal
REDIS_PORT=6379
REDIS_PASSWORD=${PROD_REDIS_PASSWORD}  # From secrets manager
REDIS_DB=0

# Redis Sentinel for high availability
REDIS_SENTINEL_ENABLED=true
REDIS_SENTINEL_HOSTS=sentinel-1:26379,sentinel-2:26379,sentinel-3:26379
REDIS_SENTINEL_MASTER_NAME=biowerk-prod

# ============================================================================
# Cache Configuration
# ============================================================================
CACHE_TTL=600  # Longer TTL for production
CACHE_ENABLED=true

# ============================================================================
# Authentication Configuration (Production)
# ============================================================================
JWT_SECRET_KEY=${PROD_JWT_SECRET}  # From secrets manager - rotate quarterly
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=15  # Shorter for security
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
API_KEY_HEADER=X-API-Key
REQUIRE_AUTH=true  # MUST be enabled in production

# ============================================================================
# TLS/HTTPS Configuration (Production)
# ============================================================================
TLS_ENABLED=true  # REQUIRED for production
TLS_CERT_FILE=/etc/ssl/certs/biowerk.crt
TLS_KEY_FILE=/etc/ssl/private/biowerk.key
TLS_CA_FILE=/etc/ssl/certs/ca-bundle.crt
TLS_VERIFY_CLIENT=false  # Enable if using mTLS
TLS_MIN_VERSION=TLSv1.3  # Strongest security
TLS_CIPHERS=  # Use system defaults (secure)

# ============================================================================
# Rate Limiting Configuration (Production)
# ============================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100  # Conservative limit
RATE_LIMIT_WINDOW=60
RATE_LIMIT_STRATEGY=sliding_window
RATE_LIMIT_PER_IP=true
RATE_LIMIT_PER_USER=true
RATE_LIMIT_BURST=20

# ============================================================================
# Agent URLs (Production Service Mesh)
# ============================================================================
AGENT_OSTEON_URL=http://prod-osteon.internal:8001
AGENT_MYOCYTE_URL=http://prod-myocyte.internal:8002
AGENT_SYNAPSE_URL=http://prod-synapse.internal:8003
AGENT_CIRCADIAN_URL=http://prod-circadian.internal:8004
AGENT_NUCLEUS_URL=http://prod-nucleus.internal:8005
AGENT_CHAPERONE_URL=http://prod-chaperone.internal:8006
AGENT_GDPR_URL=http://prod-gdpr.internal:8010

# ============================================================================
# Audit Logging Configuration (Production - Compliance Required)
# ============================================================================
AUDIT_ENABLED=true  # REQUIRED for compliance
AUDIT_LOG_REQUESTS=true
AUDIT_LOG_RESPONSES=true
AUDIT_ENCRYPT_SENSITIVE=true  # REQUIRED for PHI/PII
AUDIT_RETENTION_DAYS=365  # 1 year minimum
AUDIT_RETENTION_AUTH_DAYS=90
AUDIT_RETENTION_DATA_DAYS=2555  # 7 years for compliance
AUDIT_RETENTION_SECURITY_DAYS=730  # 2 years
AUDIT_COLLECT_GEO=true
AUDIT_MAX_FIELD_SIZE=65536
AUDIT_BATCH_SIZE=100
AUDIT_ASYNC_WRITE=true

# ============================================================================
# Encryption Configuration (Production)
# ============================================================================
ENCRYPTION_ENABLED=true  # REQUIRED for compliance
ENCRYPTION_MASTER_KEY=${PROD_ENCRYPTION_KEY}  # From KMS - DO NOT hardcode
ENCRYPTION_KEY_VERSION=1
ENCRYPTION_KEY_ROTATION_DAYS=90  # Quarterly rotation
ENCRYPTION_SALT=${PROD_ENCRYPTION_SALT}  # From secrets manager
ENCRYPTION_ALGORITHM=AES-256-GCM

# ============================================================================
# Data Retention Policy (Production - HIPAA/GDPR/SOC2)
# ============================================================================
RETENTION_ENABLED=true
RETENTION_EVALUATION_INTERVAL_HOURS=24
RETENTION_ARCHIVE_CLEANUP_INTERVAL_HOURS=168
RETENTION_DEFAULT_AUDIT_LOG_DAYS=365
RETENTION_DEFAULT_USER_DATA_DAYS=2555  # 7 years
RETENTION_DEFAULT_EXECUTION_DAYS=90
RETENTION_DEFAULT_PROJECT_DAYS=730
RETENTION_DEFAULT_ARTIFACT_DAYS=730
RETENTION_DEFAULT_API_KEY_DAYS=90
RETENTION_DEFAULT_SESSION_DAYS=30
RETENTION_DEFAULT_CACHE_DAYS=7
RETENTION_ARCHIVE_EXPIRATION_DAYS=2555
RETENTION_REQUIRE_ARCHIVE_BEFORE_DELETE=true
RETENTION_LEGAL_HOLD_ENABLED=true
RETENTION_COMPLIANCE_ALERTS_ENABLED=true
RETENTION_DRY_RUN=false

# ============================================================================
# LLM Provider Configuration (Production)
# ============================================================================
LLM_PROVIDER=anthropic  # Production-grade API
ANTHROPIC_API_KEY=${PROD_ANTHROPIC_API_KEY}
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_MAX_TOKENS=4096
ANTHROPIC_TEMPERATURE=0.7
ANTHROPIC_TIMEOUT=60

# Fallback providers
OPENAI_API_KEY=${PROD_OPENAI_API_KEY}
OPENAI_MODEL=gpt-4o
DEEPSEEK_API_KEY=${PROD_DEEPSEEK_API_KEY}

# Local Ollama for cost optimization (non-critical workloads)
OLLAMA_BASE_URL=http://prod-ollama.internal:11434
OLLAMA_MODEL=phi3:mini

# ============================================================================
# OpenTelemetry / Distributed Tracing (Production)
# ============================================================================
OTEL_ENABLED=true
OTEL_SERVICE_NAME=biowerk-production
OTEL_EXPORTER_TYPE=otlp
OTEL_EXPORTER_ENDPOINT=http://prod-jaeger.internal:4317
OTEL_EXPORTER_PROTOCOL=grpc
OTEL_SAMPLING_RATIO=0.1  # 10% sampling to reduce overhead
OTEL_LOG_CORRELATION=true
OTEL_EXPORT_TIMEOUT=30
OTEL_MAX_QUEUE_SIZE=2048
OTEL_MAX_EXPORT_BATCH_SIZE=512
OTEL_INSTRUMENT_DB=true
OTEL_INSTRUMENT_HTTP=true
OTEL_INSTRUMENT_REDIS=true

# ============================================================================
# Health Check Configuration (Production)
# ============================================================================
HEALTH_ENABLED=true
HEALTH_CHECK_DB=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_DEPENDENCIES=true
HEALTH_CHECK_TIMEOUT=5.0
HEALTH_STARTUP_GRACE_PERIOD=30

# ============================================================================
# Monitoring & Alerting (Production)
# ============================================================================
REGION=us-east-1

# High-availability endpoints
PROMETHEUS_URL=http://prod-prometheus.internal:9090
GRAFANA_URL=https://grafana.biowerk.com

# ============================================================================
# PagerDuty Integration (Production - REQUIRED)
# ============================================================================
PAGERDUTY_SERVICE_KEY=${PROD_PAGERDUTY_KEY}  # Critical alerts
PAGERDUTY_SECURITY_SERVICE_KEY=${PROD_PAGERDUTY_SECURITY_KEY}  # Security alerts

# ============================================================================
# Slack Integration (Production Channels)
# ============================================================================
SLACK_CRITICAL_WEBHOOK_URL=${SLACK_PROD_CRITICAL_WEBHOOK}
SLACK_CRITICAL_CHANNEL=#biowerk-prod-critical
SLACK_WARNINGS_WEBHOOK_URL=${SLACK_PROD_WARNINGS_WEBHOOK}
SLACK_WARNINGS_CHANNEL=#biowerk-prod-warnings
SLACK_INFO_WEBHOOK_URL=${SLACK_PROD_INFO_WEBHOOK}
SLACK_INFO_CHANNEL=#biowerk-prod-info
SLACK_DATABASE_WEBHOOK_URL=${SLACK_PROD_DATABASE_WEBHOOK}
SLACK_DATABASE_CHANNEL=#biowerk-prod-database
SLACK_SECURITY_WEBHOOK_URL=${SLACK_PROD_SECURITY_WEBHOOK}
SLACK_SECURITY_CHANNEL=#biowerk-prod-security
SLACK_COMPLIANCE_WEBHOOK_URL=${SLACK_PROD_COMPLIANCE_WEBHOOK}
SLACK_COMPLIANCE_CHANNEL=#biowerk-prod-compliance

# ============================================================================
# Email Alerting (Production)
# ============================================================================
SMTP_HOST=smtp.sendgrid.net:587  # Enterprise SMTP provider
SMTP_USERNAME=${PROD_SMTP_USERNAME}
SMTP_PASSWORD=${PROD_SMTP_PASSWORD}
DEFAULT_EMAIL_TO=ops-team@biowerk.com
DATABASE_TEAM_EMAIL=database-team@biowerk.com
COMPLIANCE_TEAM_EMAIL=compliance-team@biowerk.com

# ============================================================================
# Grafana Configuration (Production)
# ============================================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=${PROD_GRAFANA_PASSWORD}  # Strong password
GRAFANA_SECRET_KEY=${PROD_GRAFANA_SECRET}
GRAFANA_DB_TYPE=postgres  # REQUIRED for production HA
GRAFANA_DB_HOST=prod-postgres.internal:5432
GRAFANA_DB_NAME=grafana_production
GRAFANA_DB_USER=grafana_prod
GRAFANA_DB_PASSWORD=${PROD_GRAFANA_DB_PASSWORD}
GRAFANA_LOG_LEVEL=info

# ============================================================================
# Backup & Disaster Recovery (Production - CRITICAL)
# ============================================================================
BACKUP_LOG_LEVEL=INFO

# Backup schedules (production - multiple daily backups)
POSTGRES_BACKUP_ENABLED=true
POSTGRES_BACKUP_SCHEDULE=0 */6 * * *  # Every 6 hours
MONGODB_BACKUP_ENABLED=true
MONGODB_BACKUP_SCHEDULE=0 */6 * * *
REDIS_BACKUP_ENABLED=true
REDIS_BACKUP_SCHEDULE=0 */6 * * *

# Retention (production - comprehensive)
BACKUP_RETENTION_DAYS=30  # Daily backups for 30 days
BACKUP_RETENTION_WEEKLY=52  # 1 year of weekly backups
BACKUP_RETENTION_MONTHLY=84  # 7 years of monthly backups

# Backup options (production-grade)
BACKUP_COMPRESSION=zstd
BACKUP_ENCRYPTION_ENABLED=true  # REQUIRED
BACKUP_VERIFY=true  # REQUIRED
BACKUP_VERIFICATION_SCHEDULE=0 */12 * * *  # Verify twice daily

# S3 Configuration (production - multi-region)
BACKUP_S3_ENABLED=true  # REQUIRED
BACKUP_S3_BUCKET=biowerk-production-backups
BACKUP_S3_REGION=us-east-1
BACKUP_S3_STORAGE_CLASS=STANDARD_IA
AWS_ACCESS_KEY_ID=${PROD_AWS_ACCESS_KEY}  # Use IAM roles preferred
AWS_SECRET_ACCESS_KEY=${PROD_AWS_SECRET_KEY}

# Cross-region replication
BACKUP_S3_REPLICA_BUCKET=biowerk-production-backups-dr
BACKUP_S3_REPLICA_REGION=us-west-2

# DR Configuration (production - strict SLAs)
DR_RTO_TARGET=1h  # 1 hour recovery time
DR_RPO_TARGET=15m  # 15 minute data loss max
DR_TEST_ENABLED=true  # REQUIRED
DR_TEST_SCHEDULE=0 2 * * 0  # Weekly DR drill

# ============================================================================
# GDPR Configuration (Production - Compliance Required)
# ============================================================================
ENCRYPTION_MASTER_KEY=${PROD_GDPR_ENCRYPTION_KEY}  # From KMS
ENCRYPTION_KEY_ROTATION_DAYS=90
GDPR_EXPORT_BASE_PATH=/var/gdpr_exports
GDPR_SLA_DAYS=30  # GDPR requires 30 days
GDPR_EXPORT_EXPIRY_DAYS=30
GDPR_AUTO_RETENTION_ENABLED=true

# ============================================================================
# Security & Compliance
# ============================================================================
# Security headers
SECURITY_HEADERS_ENABLED=true
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000  # 1 year
CSP_ENABLED=true
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff

# WAF and DDoS protection
WAF_ENABLED=true
DDOS_PROTECTION_ENABLED=true

# ============================================================================
# Feature Flags (Production - Conservative)
# ============================================================================
ENABLE_EXPERIMENTAL_FEATURES=false  # MUST be false in production
ENABLE_DEBUG_ENDPOINTS=false  # MUST be false in production
ENABLE_VERBOSE_LOGGING=false  # MUST be false in production

# ============================================================================
# Performance & Scaling
# ============================================================================
# Auto-scaling configuration
MIN_REPLICAS=3  # Minimum for HA
MAX_REPLICAS=20  # Scale up to 20 instances
TARGET_CPU_UTILIZATION=70
TARGET_MEMORY_UTILIZATION=80

# Connection pools
DB_POOL_SIZE=20
DB_POOL_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30

# Request timeouts
REQUEST_TIMEOUT=30
LONG_REQUEST_TIMEOUT=300
BACKGROUND_TASK_TIMEOUT=3600

# ============================================================================
# Compliance & Audit
# ============================================================================
COMPLIANCE_MODE=strict
AUDIT_TRAIL_ENABLED=true
DATA_CLASSIFICATION_ENABLED=true
PII_DETECTION_ENABLED=true
PHI_PROTECTION_ENABLED=true

# Regulatory compliance
HIPAA_COMPLIANT=true
GDPR_COMPLIANT=true
SOC2_COMPLIANT=true
PCI_DSS_COMPLIANT=false  # Set to true if processing payments

# ============================================================================
# Production Best Practices Checklist
# ============================================================================
# Before deploying to production, verify:
# ✓ All secrets are managed via secure secrets manager
# ✓ TLS is enabled with TLSv1.3
# ✓ Authentication is required (REQUIRE_AUTH=true)
# ✓ Rate limiting is enabled
# ✓ Audit logging is enabled with encryption
# ✓ Backups are enabled and tested
# ✓ Multi-region replication is configured
# ✓ Monitoring and alerting is configured
# ✓ PagerDuty integration is set up
# ✓ DR procedures are documented and tested
# ✓ Security headers are enabled
# ✓ Debug features are disabled
# ✓ Log level is set to WARNING or ERROR
# ✓ GDPR compliance is enabled
# ✓ Database connection pooling is optimized
# ✓ Health checks are configured
# ✓ Auto-scaling is configured
